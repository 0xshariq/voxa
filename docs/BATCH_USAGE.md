# Voxa Batch Usage Guide

This guide explains how to add requests to a batch in Voxa, ensuring each request is tracked with a unique requestId from the Voxa instance.

## Request ID Expiry for Batch

Each batch request uses a `requestId` that includes an expiry time (15 minutes by default) to avoid conflicts between requests sent at different times. The format is:

```
<timestamp>-<expiry>-<random>
```
- `timestamp`: When the batch request was created
- `expiry`: When the requestId expires (15 min for batch)
- `random`: Random string for uniqueness

This ensures batch requests are uniquely tracked and prevents ID collisions.

## How Batch Works
- Each request added to a batch must include a `requestId` generated by the Voxa instance.
- The `BatchRequest` type requires an `ids` array, which should contain the requestId(s) for each request in the batch.
- No manager or feature should generate its own requestId; always use the one from the Voxa instance.

## Example: Adding Requests to a Batch

```typescript
import voxa from '@0xshariq/voxa';
import { BatchManager } from './features/batch/manager';

const api = voxa.create({ /* config */ });
const batchManager = new BatchManager({ endpoint: '/batch', enabled: true });

// Get the requestId from the Voxa instance
const requestId = api.instanceRequestId; // or generate per request if needed

// Add requests to the batch
batchManager.add('POST', '/users', { name: 'Alice' }, {}, requestId);
batchManager.add('GET', '/users/1', null, {}, requestId);

// When ready, batchManager.execute() will send all requests together
```

## Key Points
- Always pass the requestId from the Voxa instance when adding to a batch.
- The `ids` array in `BatchRequest` is used for tracking and correlating batched requests.
- No requestId generation should occur in batch manager or other feature managers.

## BatchRequest Type
```typescript
export interface BatchRequest {
  method: HttpMethod;
  url: string;
  data?: any;
  config?: VoxaConfig;
  resolve: (value: any) => void;
  reject: (error: any) => void;
  ids: string[]; // Array of request IDs in the batch
  priority?: 'critical' | 'high' | 'normal' | 'low'; // Optional batch priority
}
```

## Best Practices
- Use the Voxa instance's requestId for all tracking across cache, queue, batch, metadata, etc.
- Do not manually generate requestId in feature managers.
- For multi-request batches, collect all relevant requestIds in the `ids` array.

---
For more details, see the Voxa documentation or ask for advanced batch usage examples.
